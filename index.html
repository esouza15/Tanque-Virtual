<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tanque Digital Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        .fuel-gradient { background: linear-gradient(90deg, #ef4444 0%, #facc15 25%, #22c55e 100%); }
        body { background-color: #111827; color: white; -webkit-tap-highlight-color: transparent; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .log-item:nth-child(even) { background-color: rgba(255,255,255,0.03); }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="font-sans min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-md py-4 text-center">
        <h1 class="text-xl font-bold text-gray-500 uppercase tracking-widest">Meu Tanque Digital <span class="text-[10px] bg-blue-900 px-2 py-1 rounded text-blue-200">PRO</span></h1>
    </header>

    <main class="w-full max-w-md bg-gray-800 rounded-[2.5rem] shadow-2xl p-6 border border-gray-700">
        <div class="text-center mb-6">
            <div id="litros-display" class="text-7xl font-black text-green-400 transition-colors duration-500">0.0</div>
            <div class="text-gray-500 uppercase text-xs font-bold tracking-widest mt-1">Litros no Tanque</div>
        </div>

        <div class="relative w-full h-10 bg-gray-900 rounded-2xl overflow-hidden mb-6 border-2 border-gray-700 shadow-inner">
            <div id="fuel-bar" class="h-full fuel-gradient transition-all duration-1000" style="width: 0%"></div>
            <div class="absolute left-1/4 top-0 bottom-0 w-0.5 bg-white/20"></div>
            <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-white/20"></div>
        </div>

        <div class="text-center mb-6 bg-black/40 p-4 rounded-2xl border border-gray-700/50 shadow-inner">
            <div class="text-gray-500 uppercase text-[10px] font-bold tracking-tighter mb-1">Odômetro Registrado</div>
            <div class="text-3xl font-mono text-blue-400 font-bold"><span id="km-atual-texto">0</span> <span class="text-base text-blue-700">KM</span></div>
        </div>

        <div class="space-y-6">
            <div class="flex gap-3 mb-6">
                <div class="flex-[2.5]">
                    <label class="block text-gray-400 text-[10px] font-bold uppercase mb-1 ml-1">Nova KM</label>
                    <div class="flex items-center bg-gray-900 rounded-xl p-1 border border-gray-600 shadow-inner">
                        <button onclick="ajustarKm(-1)" class="px-2 py-2 text-xl font-bold text-gray-400 active:text-white">－</button>
                        <input type="number" id="km-input" class="w-full bg-transparent text-center outline-none text-2xl font-mono font-bold text-blue-400" placeholder="000000">
                        <button onclick="ajustarKm(1)" class="px-2 py-2 text-xl font-bold text-gray-400 active:text-white">＋</button>
                    </div>
                </div>

                <div class="flex-1">
                    <label class="block text-gray-400 text-[10px] font-bold uppercase mb-1 ml-1 text-center">KM/L</label>
                    <input type="number" id="consumo-input" step="0.1" class="w-full h-[54px] bg-gray-900 border border-gray-600 rounded-xl p-1 text-xl text-center outline-none text-blue-400 font-mono shadow-inner" value="7.0">
                </div>
            </div>

            <div>
                <label class="block text-gray-400 text-[10px] font-bold uppercase mb-1">Abastecimento (Litros Adicionados)</label>
                <input type="number" id="litros-add" class="w-full bg-gray-900 border border-gray-600 rounded-xl p-4 text-2xl text-center outline-none text-green-400" placeholder="0.0">
            </div>

            <button onclick="atualizarDados()" id="btn-salvar" class="w-full bg-green-600 active:scale-[0.98] transition-all text-white font-black py-5 rounded-[1.5rem] text-xl shadow-xl border-b-8 border-green-800 uppercase tracking-widest">
                Salvar Registro
            </button>
        </div>

        <div class="mt-8">
            <h2 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3 flex justify-between items-center">
                <span>Histórico de Logs</span>
                <button onclick="limparHistorico()" class="text-red-900 hover:text-red-700 transition-colors uppercase">Limpar</button>
            </h2>
            <div id="historico-lista" class="max-h-48 overflow-y-auto space-y-1 rounded-xl bg-black/20 p-2 border border-gray-700 hide-scroll">
                </div>
        </div>

        <div class="mt-6 pt-6 border-t border-gray-700 flex justify-between gap-4">
            <button onclick="exportarDados()" class="flex-1 bg-gray-700/50 hover:bg-gray-700 text-gray-400 text-[9px] font-bold py-2 rounded-lg uppercase tracking-tighter">Exportar Backup</button>
            <button onclick="importarDados()" class="flex-1 bg-gray-700/50 hover:bg-gray-700 text-gray-400 text-[9px] font-bold py-2 rounded-lg uppercase tracking-tighter">Importar Backup</button>
        </div>
    </main>

    <footer class="mt-6 text-gray-600 text-[10px] uppercase tracking-widest">
        Capacidade: 54L | Sedã 1.8 | Devi AI
    </footer>

    <script>
        // Carrega dados da Versão 2 (com histórico e consumo)
        let appData = JSON.parse(localStorage.getItem('tanque_dados_v2')) || { 
            litros: 0, 
            km: 0, 
            consumo: 7.0,
            historico: [] 
        };

        function ajustarKm(valor) {
            const input = document.getElementById('km-input');
            let valorInput = parseInt(input.value) || 0;
            // Trava para não descer abaixo do odômetro salvo
            if (valor < 0 && valorInput <= appData.km) return;
            input.value = valorInput + valor;
        }

        function atualizarTela() {
            const porcentagem = (appData.litros / 54) * 100;
            document.getElementById('litros-display').innerText = appData.litros.toFixed(1);
            document.getElementById('fuel-bar').style.width = `${Math.min(100, porcentagem)}%`;

            // Atualiza o Destaque do Odômetro e o Campo de Input
            document.getElementById('km-atual-texto').innerText = appData.km.toLocaleString('pt-BR');
            document.getElementById('km-input').value = appData.km;
            document.getElementById('consumo-input').value = appData.consumo;

            const display = document.getElementById('litros-display');
            display.classList.toggle('text-red-500', appData.litros < 6.75);
            display.classList.toggle('text-green-400', appData.litros >= 6.75);

            renderizarHistorico();
        }

        function renderizarHistorico() {
            const lista = document.getElementById('historico-lista');
            if (appData.historico.length === 0) {
                lista.innerHTML = '<div class="text-center text-gray-600 py-4 text-[10px] italic uppercase">Sem registros</div>';
                return;
            }

            lista.innerHTML = '';
            // Mostra os logs do mais recente para o mais antigo
            [...appData.historico].reverse().forEach(log => {
                const div = document.createElement('div');
                div.className = 'log-item p-2 text-[10px] flex justify-between items-center border-b border-white/5';
                div.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-gray-500 font-mono">${log.data}</span>
                        <span class="text-blue-400 font-bold">${log.km.toLocaleString('pt-BR')} KM</span>
                    </div>
                    <div class="text-right">
                        <div class="text-green-500 font-bold">${log.litros_add > 0 ? '+'+log.litros_add+'L' : ''}</div>
                        <div class="text-white">Tanque: ${log.litros_final.toFixed(1)}L</div>
                    </div>
                `;
                lista.appendChild(div);
            });
        }

        function atualizarDados() {
            const novaKm = parseFloat(document.getElementById('km-input').value);
            const novosLitros = parseFloat(document.getElementById('litros-add').value) || 0;
            const novoConsumo = parseFloat(document.getElementById('consumo-input').value) || 7.0;

            if (novaKm < appData.km) {
                alert("A quilometragem não pode ser menor que a atual registrada.");
                return;
            }

            const distancia = novaKm - appData.km;
            const gasto = distancia / novoConsumo;
            const litrosFinais = Math.min(54, Math.max(0, appData.litros - gasto) + novosLitros);

            // Objeto do Log
            const novoLog = {
                data: new Date().toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'}) + ' ' + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}),
                km: novaKm,
                litros_add: novosLitros,
                litros_final: litrosFinais
            };

            // Atualiza Memória
            appData.litros = litrosFinais;
            appData.km = novaKm;
            appData.consumo = novoConsumo;
            appData.historico.push(novoLog);

            // Mantém apenas os últimos 30 logs para não sobrecarregar
            if (appData.historico.length > 30) appData.historico.shift();

            localStorage.setItem('tanque_dados_v2', JSON.stringify(appData));

            atualizarTela();
            document.getElementById('litros-add').value = '';

            const btn = document.getElementById('btn-salvar');
            btn.innerText = "DADOS GRAVADOS!";
            btn.classList.replace('bg-green-600', 'bg-blue-600');
            setTimeout(() => {
                btn.innerText = "SALVAR REGISTRO";
                btn.classList.replace('bg-blue-600', 'bg-green-600');
            }, 2000);
        }

        function exportarDados() {
            const dadosStr = JSON.stringify(appData);
            navigator.clipboard.writeText(dadosStr).then(() => {
                alert("Código de Backup e Histórico copiado!");
            });
        }

        function importarDados() {
            const backup = prompt("Cole seu código de backup aqui:");
            if (backup) {
                try {
                    const parsed = JSON.parse(backup);
                    if (parsed.km !== undefined) {
                        appData = parsed;
                        localStorage.setItem('tanque_dados_v2', JSON.stringify(appData));
                        atualizarTela();
                        alert("Backup restaurado com sucesso!");
                    }
                } catch (e) { alert("Erro ao ler backup."); }
            }
        }

        function limparHistorico() {
            if (confirm("Apagar apenas a lista de histórico? Os litros e KM atuais serão mantidos.")) {
                appData.historico = [];
                localStorage.setItem('tanque_dados_v2', JSON.stringify(appData));
                atualizarTela();
            }
        }

        // Inicializa a tela
        atualizarTela();
    </script>
</body>
</html>