<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tanque Digital Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        .fuel-gradient { background: linear-gradient(90deg, #ef4444 0%, #facc15 25%, #22c55e 100%); }
        body { background-color: #111827; color: white; -webkit-tap-highlight-color: transparent; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .log-item:nth-child(even) { background-color: rgba(255,255,255,0.03); }
    </style>
</head>
<body class="font-sans min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-md py-4 text-center">
        <h1 class="text-xl font-bold text-gray-500 uppercase tracking-widest">Meu Tanque Digital <span class="text-[10px] bg-blue-900 px-2 py-1 rounded text-blue-200">PRO</span></h1>
    </header>

    <main class="w-full max-w-md bg-gray-800 rounded-[2.5rem] shadow-2xl p-6 border border-gray-700">
        <div class="text-center mb-6">
            <div id="litros-display" class="text-7xl font-black text-green-400 transition-colors duration-500">0.0</div>
            <div class="text-gray-500 uppercase text-xs font-bold tracking-widest mt-1">Litros no Tanque</div>
        </div>

        <div class="relative w-full h-10 bg-gray-900 rounded-2xl overflow-hidden mb-8 border-2 border-gray-700">
            <div id="fuel-bar" class="h-full fuel-gradient transition-all duration-1000" style="width: 0%"></div>
            <div class="absolute left-1/4 top-0 bottom-0 w-0.5 bg-white/20"></div>
            <div class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-white/20"></div>
        </div>

        <div class="space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-400 text-[10px] font-bold uppercase mb-1">KM Atual</label>
                    <div class="flex items-center bg-gray-900 rounded-xl p-1 border border-gray-600">
                        <button onclick="ajustarKm(-1)" class="px-3 py-2 text-xl font-bold">－</button>
                        <input type="number" id="km-input" class="w-full bg-transparent text-center outline-none text-xl font-mono" placeholder="000000">
                        <button onclick="ajustarKm(1)" class="px-3 py-2 text-xl font-bold">＋</button>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-400 text-[10px] font-bold uppercase mb-1">Consumo (km/l)</label>
                    <input type="number" id="consumo-input" step="0.1" class="w-full bg-gray-900 border border-gray-600 rounded-xl p-3 text-xl text-center outline-none text-blue-400" value="7.0">
                </div>
            </div>

            <div class="grid grid-cols-1">
                <label class="block text-gray-400 text-[10px] font-bold uppercase mb-1">Abasteceu quantos litros?</label>
                <input type="number" id="litros-add" class="w-full bg-gray-900 border border-gray-600 rounded-xl p-4 text-2xl text-center outline-none text-green-400" placeholder="0.0">
            </div>

            <button onclick="atualizarDados()" id="btn-salvar" class="w-full bg-green-600 active:scale-[0.98] transition-all text-white font-black py-5 rounded-[1.5rem] text-xl shadow-xl border-b-8 border-green-800 uppercase tracking-widest">
                Salvar Registro
            </button>
        </div>

        <div class="mt-10">
            <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4 flex justify-between">
                Histórico Recente
                <span onclick="limparHistorico()" class="text-red-900 cursor-pointer">Limpar</span>
            </h2>
            <div id="historico-lista" class="max-h-60 overflow-y-auto space-y-1 rounded-xl bg-black/20 p-2 border border-gray-700">
                </div>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-700 flex justify-between gap-4">
            <button onclick="exportarDados()" class="flex-1 bg-gray-700/50 text-gray-300 text-[9px] font-bold py-2 rounded-lg uppercase">Exportar Backup</button>
            <button onclick="importarDados()" class="flex-1 bg-gray-700/50 text-gray-300 text-[9px] font-bold py-2 rounded-lg uppercase">Importar Backup</button>
        </div>
    </main>

    <script>
        // Dados Estruturados
        let appData = JSON.parse(localStorage.getItem('tanque_dados_v2')) || { 
            litros: 0, 
            km: 0, 
            consumo: 7.0,
            historico: [] 
        };

        function ajustarKm(valor) {
            const input = document.getElementById('km-input');
            let valorInput = parseInt(input.value) || 0;
            if (valor < 0 && valorInput <= appData.km) return;
            input.value = valorInput + valor;
        }

        function atualizarTela() {
            const porcentagem = (appData.litros / 54) * 100;
            document.getElementById('litros-display').innerText = appData.litros.toFixed(1);
            document.getElementById('fuel-bar').style.width = `${Math.min(100, porcentagem)}%`;
            document.getElementById('km-input').value = appData.km;
            document.getElementById('consumo-input').value = appData.consumo;

            const display = document.getElementById('litros-display');
            display.classList.toggle('text-red-500', appData.litros < 6.75);
            display.classList.toggle('text-green-400', appData.litros >= 6.75);

            renderizarHistorico();
        }

        function renderizarHistorico() {
            const lista = document.getElementById('historico-lista');
            lista.innerHTML = appData.historico.length ? '' : '<div class="text-center text-gray-600 py-4 text-xs italic">Nenhum registro ainda</div>';

            appData.historico.slice().reverse().forEach(log => {
                const div = document.createElement('div');
                div.className = 'log-item p-2 text-[11px] flex justify-between items-center border-b border-white/5';
                div.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-gray-500 font-mono">${log.data}</span>
                        <span class="text-blue-400 font-bold">${log.km.toLocaleString()} KM</span>
                    </div>
                    <div class="text-right">
                        <div class="text-green-400 font-bold">${log.litros_add > 0 ? '+'+log.litros_add+'L' : ''}</div>
                        <div class="text-white">Tanque: ${log.litros_final.toFixed(1)}L</div>
                    </div>
                `;
                lista.appendChild(div);
            });
        }

        function atualizarDados() {
            const novaKm = parseFloat(document.getElementById('km-input').value);
            const novosLitros = parseFloat(document.getElementById('litros-add').value) || 0;
            const novoConsumo = parseFloat(document.getElementById('consumo-input').value) || 7.0;

            if (novaKm < appData.km) { alert("KM não pode ser menor que a atual."); return; }

            const distancia = novaKm - appData.km;
            const gasto = distancia / novoConsumo;
            const litrosFinais = Math.min(54, Math.max(0, appData.litros - gasto) + novosLitros);

            // Adicionar ao Histórico
            const novoLog = {
                data: new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}),
                km: novaKm,
                litros_add: novosLitros,
                litros_final: litrosFinais,
                consumo_usado: novoConsumo
            };

            appData.litros = litrosFinais;
            appData.km = novaKm;
            appData.consumo = novoConsumo;
            appData.historico.push(novoLog);
            if(appData.historico.length > 50) appData.historico.shift(); // Mantém os últimos 50

            localStorage.setItem('tanque_dados_v2', JSON.stringify(appData));

            atualizarTela();
            document.getElementById('litros-add').value = '';

            const btn = document.getElementById('btn-salvar');
            btn.innerText = "REGISTRADO!";
            btn.classList.replace('bg-green-600', 'bg-blue-600');
            setTimeout(() => {
                btn.innerText = "SALVAR REGISTRO";
                btn.classList.replace('bg-blue-600', 'bg-green-600');
            }, 2000);
        }

        function exportarDados() {
            const dadosStr = JSON.stringify(appData);
            navigator.clipboard.writeText(dadosStr).then(() => {
                alert("Backup (com histórico) copiado!");
            });
        }

        function importarDados() {
            const backup = prompt("Cole o código de backup:");
            if (backup) {
                try {
                    appData = JSON.parse(backup);
                    localStorage.setItem('tanque_dados_v2', JSON.stringify(appData));
                    atualizarTela();
                    alert("Dados e Histórico restaurados!");
                } catch (e) { alert("Erro no backup."); }
            }
        }

        function limparHistorico() {
            if(confirm("Deseja apagar todo o histórico de logs? (O nível do tanque atual será mantido)")) {
                appData.historico = [];
                localStorage.setItem('tanque_dados_v2', JSON.stringify(appData));
                atualizarTela();
            }
        }

        atualizarTela();
    </script>
</body>
</html>